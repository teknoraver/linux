// SPDX-License-Identifier: GPL-2.0
/*
 * Device Tree file for Eswin EIC7700 SoC.
 *
 * Copyright 2024, Beijing ESWIN Computing Technology Co., Ltd.. All rights reserved.
 * SPDX-License-Identifier: GPL-2.0
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, version 2.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

#include "eic7700-som260-a1.dtsi"

/ {
	#address-cells = <2>;
	#size-cells = <2>;
	model = "ESWIN EIC7700 Z530";

	gpio-keys {
		compatible = "gpio-keys";

		ap_backup {
			label = "ap-backup";
			linux,code = <KEY_OK>;
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_gpio26_default>;
			gpios = <&porta 26 GPIO_ACTIVE_LOW>;
		};
	};
	reg_vcc1v8: vcc1v8 {
		compatible = "regulator-fixed";
		regulator-name = "vcc1v8";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};
};

&d0_gmac0 {
	dly-param-1000m = <0x23232323 0xa0209023 0x20202020>;
	dly-param-100m = <0x50505050 0x803f8050 0x3f3f3f3f>;
	dly-param-10m = <0 0 0>;
};

&d0_gmac1 {
	dly-param-1000m = <0x00000000 0xe002e000 0x04040404>;
	dly-param-100m = <0x48484848 0x80588048 0x58585858>;
	dly-param-10m = <0 0 0>;
};


&pcie {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_gpio10_default>;
	pci-prsnt = <&porta 10 GPIO_ACTIVE_LOW>;
};

&sdio0 {
	/* sd card */
	delay_code = <0x3b>;
	drive-impedance-ohm = <33>;
	enable-cmd-pullup;
	enable-data-pullup;
	no-sdio;
	no-mmc;
};

&sdio1 {
	/* wifi module */
	delay_code = <0x32>;
	drive-impedance-ohm = <33>;
	enable-cmd-pullup;
	enable-data-pullup;
	keep-power-in-suspend;
	non-removable;
	no-sd;
	no-mmc;
	vqmmc-supply = <&reg_vcc1v8>;
	aw3155:wifi_aw3155@0 {
		compatible = "aml_w1_sdio";
		reg = <0x0>;
		interrupt-parent = <&porta>;
		interrupts = <15 IRQ_TYPE_LEVEL_LOW>;
		pinctrl-names = "default", "default";
		pinctrl-0 = <&pinctrl_gpio15_default>;
		pinctrl-1 = <&pinctrl_gpio79_default>;
		irq-gpios = <&porta 15 GPIO_ACTIVE_HIGH>;
		rst-gpios = <&portc 15 GPIO_ACTIVE_HIGH>;

	};
	mdhd_wlan {
		compatible = "android,bcmdhd_wlan";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_gpio79_default>;
		gpio_wl_reg_on = <&portc 15 GPIO_ACTIVE_HIGH>;
	};
};

&ssi0 {
	/* lora */
};

&ssi1 {
	/* unused */
	status = "disabled";
};

&d0_graphcard1 {
	status = "okay";
	label = "Analog Audio-0";
	dais = <&d0_i2s1_port>;
};

&d0_graphcard2 {
	status = "disabled";
};

&d0_i2s1 {
	status = "okay";
	d0_i2s1_port: port {
		d0_i2s1_endpoint: endpoint {
			remote-endpoint = <&d0_codec0_endpoint>;
			dai-format = "i2s";
		};
	};
};

&d0_i2s2 {
	status = "disabled";
};

&d0_i2c0 {
	/* codec es8388 */
	d0_es8388_0: es8388-0@10 {
		compatible = "eswin,es8388";
		reg = <0x10>;
		#sound-dai-cells = <0>;
		eswin-plat = <3>;
		port {
			d0_codec0_endpoint: endpoint {
				system-clock-frequency = <12288000>;
				remote-endpoint = <&d0_i2s1_endpoint>;
			};
		};
	};
};

&d0_i2c1 {
	/* rtc rs4c411 & mipi dsi */

};

&d0_i2c2 {
	/* touch screen*/
	gt911:touchscreen@14 {
		compatible = "goodix,gt911";
		reg = <0x14>;
		interrupt-parent = <&porta>;
		interrupts = <0 IRQ_TYPE_EDGE_RISING>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_gpio0_default &pinctrl_gpio92_default>;
		irq-gpios = <&porta 0 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&portc 28 GPIO_ACTIVE_HIGH>;
	};
};

&d0_aon_i2c0 {
	/* rk628f */
	status = "okay";
	i2c-sda-hold-time-ns = <1000>;

	rk628_csi: rk628_csi@50 {
		reg = <0x50>;
		compatible = "rockchip,rk628-csi-v4l2";
		status = "okay";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_gpio70_default &pinctrl_gpio71_default &pinctrl_gpio73_default &pinctrl_gpio9_default>;
		/* pinctrl-0 = <&rk628_pin>; */
		/* RK628_INT_H GPIO_070 input */
		interrupt-parent = <&portc>;
		interrupts = <6 IRQ_TYPE_EDGE_RISING>;
		/* RK628_PWR_EN_H_3V3 GPIO_073 output high */
		enable-gpios = <&portc 9 GPIO_ACTIVE_HIGH>;
		/* RK628_RESET_H GPIO_071 output high */
		reset-gpios = <&portc 7 GPIO_ACTIVE_HIGH>;
		/* RK628_Plugin_DET_1V8 GPIO_009 input */
		plugin-det-gpios = <&porta 9 GPIO_ACTIVE_LOW>;
		continues-clk = <1>;

		rockchip,camera-module-index = <0>;
		rockchip,camera-module-facing = "back";
		rockchip,camera-module-name = "HDMI-MIPI";
		rockchip,camera-module-lens-name = "RK628-CSI";
/*
		multi-dev-info {
			dev-idx-l = <0>;
			dev-idx-r = <1>;
			combine-idx = <0>;
			pixel-offset = <0>;
			dev-num = <2>;
		};
*/
		port {
			hdmiin_out0: endpoint {
				remote-endpoint = <&mipidphy0_in_ucam0>;
				data-lanes = <1 2>;
				link-frequencies = /bits/ 64 <456000000>;
			};
		};
	};
};

&csi2_dphy_hw {
	status = "okay";
};

&csi2_dphy0 {
	status = "okay";
	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;

			mipidphy0_in_ucam0: endpoint@1 {
				reg = <1>;
				remote-endpoint = <&hdmiin_out0>;
				data-lanes = <1 2>;
			};
		};

		port@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;

			csidphy0_out: endpoint@0 {
				reg = <0>;
				remote-endpoint = <&mipi2_csi2_input>;
				data-lanes = <1 2>;
			};
		};
	};
};

&csi2_dphy1 {
	status = "disabled";
};

&mipi_csi2_0 {
	status = "okay";
	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;

			mipi2_csi2_input: endpoint@1 {
				reg = <1>;
				remote-endpoint = <&csidphy0_out>;
				data-lanes = <1 2>;
			};
		};

		port@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;

			mipi2_csi2_output: endpoint@0 {
				reg = <0>;
				remote-endpoint = <&axi2dvp_mipi2_in0>;
				data-lanes = <1 2>;
			};
		};
	};
};

&dvp2axi {
	status = "okay";
};

&dvp2axi_mipi_lvds {
	status = "okay";
	port {
		axi2dvp_mipi2_in0: endpoint {
			remote-endpoint = <&mipi2_csi2_output>;
			data-lanes = <1 2>;
		};
	};
};

&mipi_dphy_rx {
	status = "disabled";
};

&csi_dma0 {
	status = "disabled";
};

&csi_dma1 {
	status = "disabled";
};

&csi2_0 {
	status = "disabled";
};

&csi2_1 {
	status = "disabled";
};

/* GPIO Function Description
	gpio0   : touch int(I)
	gpio5   : 5g wake on host(I)
	gpio6   : 5g disable2(O)
	gpio7   : mipi dsi ctrl(O)
	gpio8   : 5g disable1(O)
	gpio9   : rk628 plugin detect(I)
	gpio10  : pcie prsnt(I)
	gpio12  : bt wake host(I)
	gpio15  : wlan wake host(I)
	gpio26  : ap backup(I)
	gpio39  : lora busy(I)
	gpio41  : host wake bt(I)
	gpio70  : rk628 int(I)
	gpio71  : rk628 reset(O)
	gpio73  : rk628 power enable(O)
	gpio74  : 5g pwren(O)
	gpio76  : eth rset(O)
	gpio77  : lora nreset(O)
	gpio79  : m2 power on(O)
	gpio80  : lora ctrl2(O)
	gpio81  : lora ctrl1(O)
	gpio92  : touch rstn(O)
	gpio93  : 5g reset(O)
*/